---
title: プライベートメソッドのテストについて
date: 2013-11-18 21:07:00 +0900
---

### プライベートメソッドのテスト書いてて思ったことの記録

とあるプロダクトで、APIにRequestを送る部分のテストを書いている時に、
private メソッドをテストしようとしたところ、むむ、テストできないぞ！
となりました。

protected なメソッドならテストできるけど、privateなメソッドだとテストできない！となって
ReflectionMethod を使用しようとしたらPHP5.3からなのでだめでした。
(テストを書いているプロダクトコードはPHP5.1系を使っている)

メソッドのスコープをprotected(もしくはfinal protected)にするしかないのか。。

と思った時に、そもそもprivate なメソッドってテストするべきものではない!?
というふうに思ってきて、外からアクセスできるpublic なメソッドを通してテストするようにしないと
いけないのでは？ということを周りの開発メンバーに話して色々考えた。

public メソッドを通してprivateなメソッドもテストができているなら、
privateメソッドのテストは書かなくて良いという話になってしまうのですが、
privateメソッドの中でif文とかで条件分岐があった時に、
その条件分岐の部分もテストできているか?みたいなことを考慮しないといけない。

publicなメソッドのテストを通そうとするのが難しい時はprivateのテストも書いて、
まずは落ちるテストを書いて、テストが通るように修正する事からはじめることにしました。
（RED → GREEN → リファクタリング のサイクル！）

そして、メソッドを分割したり、他のクラスに移動したりとかリファクタリングしていく中で、
最終的にprivateメソッドのテストが必要無くなったら、それまでに使っていたprivateメソッドのテストは消せば良い。
という自分の中でのとりあえずの答えです。

今、自分がテストを書いている状況はプロダクトコードが自分で書いた状態ではなく、
テストコードがないという状況だったので、テストを書くことは仕様を書いていく意味も含んでいると思い、
privateなメソッドのテストを書くことは、リファクタリングのはじめの一歩としては良いと考え、
書くことにしました。

納期と自分の技術と要相談ですが、RED → GREEN → リファクタリングを繰り返して、
privateメソッドのテストを消せた時には良い設計に近づいているはず！


### 参考
プライベートメソッドのユニットテストは書かないもの？  
http://qa.atmarkit.co.jp/q/2784

privateメソッドのテストについて気になったので読んでみた。勉強になる！
